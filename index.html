<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<meta http-equiv="Cache-Control" content="no-cache" />
		
		<link rel="stylesheet" type="text/css" href="css/jsTable.css">

		<script src="js/jquery-2.2.0.min.js"></script>
		<script src="js/uService.js"></script>
		<script src="js/objectlink.js"></script></head>
		<script src="js/jscharts.js"></script></head>
		<script src="js/GetSet.js"></script>
		<script src="js/Filter.js"></script>
		<script src="js/Column.js"></script>
		<script src="js/JsTable.js"></script>
		
<script>
	var classes_ = objectlink.gOrm("gT2",[["Класс"],[],[0],false,["Класс","id_Класс"]]);
	var classes = hash4arr(classes_);
////////////documentReady
	$(document).ready(function(){
		var pLogin = gDom("pLogin");
		pLogin.style.left = Math.round(windowWidth()/2) - 100 + "px";
		pLogin.style.top = Math.round(windowHeight()/2) - 50 + "px";

		var bLogin = gDom("bLogin");
		bLogin.onclick = function(){
			var eUser = $("#eUser").val();
			var password = document.fLogin.ePassword.value;
			var u = objectlink.gOrm("gAnd",[[classes["Пользователи"]],"id",false,"and n='"+eUser+"'"]);
			var p = objectlink.gOrm("gAnd",[[classes["Пароли пользователей"]],"id",false,"and n='"+password+"'"]);
			if (u && p && u.length && p.length){
				var key = objectlink.gOrm("gAnd", [[u[0][0], p[0][0], classes["Ключи доступа пользователей"]]]);
				console.log(p[0][0]);
				if (key && key.length){
					gDom("mainContainer").hidden = true;
				}
			}
		}
		
////////////////modal
		var modal = document.getElementById('myModal');
		var span = document.getElementsByClassName("close")[0];
		var divData = gDom("divData");

		span.onclick = function() {
			modal.style.display = "none";
		}

		window.onclick = function(event) {
			if (event.target == modal) {
				modal.style.display = "none";
			}
		}
		
		window.onkeydown = function(event) {
			if (event.keyCode == 27) {
				modal.style.display = "none";
			}
		};

////////////////showModal
		function showModalHtml(html, clear){
			if (clear){
				gDom("modalTitle").innerHTML = "";
				gDom("modalBody").innerHTML = "";
				gDom("modalFooter").innerHTML = "";
			}
			$("#modalBody").append(html);
			modalCont.style.top = "100px";//Math.round(windowHeight()/2-parseInt($("#modalBody").height())/2)-20+"px";
			modal.style.display = "block";
			//modalCont.style.left = Math.round(windowWidth()/2-parseInt($("#modalBody").width())/2)-70+"px";
			
		}

		function showInf(container, html){
			container.innerHTML = "";
			$(container).append(html);
			container.parentNode.hidden = false;				
		}
		
		window.onhashchange = function(){
			hashchange();
		}
/*		
		var oid = $_GET("oid", "#", location.hash);
		hashchange();
		
		function hashchange(){
			oid = $_GET("oid", "#", location.hash);// || "115";
		}
*/
/*
		var cntf = new TContainerFactory();
		var div = divData.appendChild(cDom("DIV"));
		var zdp, zdz, zds;
		var cnt = cntf.create("hidden", div, "", null, function(that){
			return "Заказ "+that.iii;//(zdp.value || d2str(new Date()))
		});
		var zakaz = new TField(classes["Заказы ПИР"], null, cnt);
		
		zdp = new TField(classes["Заказы дата подписания"], null, cntf.create("date", div), zakaz);
		zdz = new TField(classes["Заказы дата закрытия"], null, cntf.create("date", div), zakaz);
		zds = new TField(classes["Заказы статус"], null, cntf.create("checkbox", div), zakaz, "123");
		
		var arr = [zakaz, zdp, zdz];
		var but = cDom("BUTTON", null, div);
		but.innerHTML = "save";
		but.onclick = function() {
			//console.log(zds.value);
			//cnt.cnt.iii = 123;
			//console.log(zakaz.value);
			//for (var i=0; i < arr.length; i++) {
			//	arr[i].save();
			//	console.log(arr[i].oid);
			//}
		}
*/
		var card1 = createFieldsCard(
			["Заказы ПИР","Заказы дата подписания","Заказы дата закрытия","Заказы статус"],
			["hidden","date","date","checkbox"], ["Заказ ", 1], null, null, true);
		divData.appendChild(card1);
		
		var ch = new TCheckboxes(["2 соава","3"],["1","2 соава","3","4"], null, divData);
		var but = cDom("BUTTON", null, divData);
		but.innerHTML = "save";
		but.onclick = function() {
			console.log(ch.checked);
		}

/////////////TForm		
		var f = new TForm(document.body);
		f.visible = true;
		var v = cDom("BUTTON");
		v.innerHTML = "123";
		f.body = v;
		f.top = 200;

		var f2 = new TForm(document.body, 100, 100, 100, 100);
		v.f = f2;
		
		v.onclick = function(){
			this.f.visible = true;
		};
		
		var v2 = cDom("BUTTON");
		v2.innerHTML = "123";
		f2.body = v2;
		v2.f2 = f2;
		v2.f = f;
		
		v2.onclick = function(){
			this.f.visible = false;
			this.f2.visible = false;
		};
		
	
	})
</script>

	</head>
	<body>
		<div id="myModal" class="modal">
		  <div class="modal-content" id="modalCont">
			<div class="modal-header">
			  <span class="close">&times;</span>
			  <h3 id='modalTitle'></h2>
			</div>
			<div class="modal-body" id='modalBody'>
			</div>
			<div class="modal-footer" id='modalFooter'>
			</div>
		  </div>
		</div>
		
		<table style='width:100%; height:100%' id="mainTable">
		<tr style='height:100px'>
			<td align="center"></td>
		</tr>
		<tr height="100%">
			<td class="jsTableContainer" id="divData" align='center'>
			</td>
		</tr>
		</table>
		
		<div id='logo' style='position:absolute; left:0px; top:10px; width:100px; text-align:center; border-radius:5px'>
			<table><tr><td align='center'><img src='images/logo.png' width='128'/></td></tr>
			<tr><td align='center'><label>База Данных</label></td></tr></table>
		</div>
		
		<div style='position:absolute; left:0px; top:0px; width:100%; height:100%; z-index:1100000; background-color:rgba(0,0,0,0.7)' hidden id='mainContainer'>
			<div id='pLogin' style='position:fixed; left:500px; top:400px; background-color:rgba(0,0,0,0.5)'>
				<form name="fLogin" onsubmit='return false;' id='fLogin'>
				<table cellpadding="5" cellspacing="5">
					<tr><td>Логин:</td><td> <input type='text' id='eUser' autofocus></td></tr>
					<tr><td>Пароль:</td><td> <input type='password' id='ePassword' name='ePassword'></td></tr>
					<tr><td colspan=2 align='center'><button id='bLogin'>Войти</button></td></tr>
				</table>
				</form>
			</div>
		</div>
		
	</body>
</html>